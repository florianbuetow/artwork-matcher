# Default recipe: show available commands
_default:
    @just --list

# Initialize the tools environment
init:
    @echo ""
    @printf "\033[0;34m=== Initializing Tools Environment ===\033[0m\n"
    @uv sync
    @printf "\033[0;32m✓ Tools environment ready\033[0m\n"
    @echo ""

# Destroy the virtual environment
destroy:
    @echo ""
    @printf "\033[0;34m=== Destroying Virtual Environment ===\033[0m\n"
    @rm -rf .venv
    @printf "\033[0;32m✓ Virtual environment removed\033[0m\n"
    @echo ""

# Run full E2E evaluation (starts Docker, builds index, evaluates)
run-evaluation testdata="../data/evaluation":
    @echo ""
    @printf "\033[0;34m=== Running E2E Evaluation ===\033[0m\n"
    @uv run python run_evaluation.py --testdata "{{testdata}}"
    @echo ""

# Run evaluation only (assumes services running and index built)
evaluate-only testdata="../data/evaluation":
    @echo ""
    @printf "\033[0;34m=== Running Evaluation ===\033[0m\n"
    @uv run python evaluate.py --testdata "{{testdata}}"
    @echo ""

# Build the FAISS index from object images
build-index objects="../data/evaluation/objects":
    @echo ""
    @printf "\033[0;34m=== Building Index ===\033[0m\n"
    @uv run python build_index.py --objects "{{objects}}"
    @echo ""

# Evaluate accuracy against labels.csv (alias for evaluate-only)
evaluate testdata="../data/evaluation":
    @echo ""
    @printf "\033[0;34m=== Evaluating Accuracy ===\033[0m\n"
    @uv run python evaluate.py --testdata "{{testdata}}"
    @echo ""

# Verify the E2E evaluation pipeline is correctly wired up
verify testdata="../data/evaluation" reports="../reports/evaluation":
    @echo ""
    @printf "\033[0;34m=== Verifying E2E Evaluation ===\033[0m\n"
    @uv run python verify_evaluation.py --testdata "{{testdata}}" --reports "{{reports}}"
    @echo ""

# Download Rijksmuseum data (pass arguments after --)
download *ARGS:
    @echo ""
    @printf "\033[0;34m=== Downloading Rijksmuseum Data ===\033[0m\n"
    @uv run python downloader/download_data.py {{ ARGS }}
    @echo ""

# Show download configuration and available options
download-info:
    @uv run python downloader/download_data.py --info

# Download test batch (5 objects with images)
download-test:
    @echo ""
    @printf "\033[0;34m=== Test Download (5 objects) ===\033[0m\n"
    @uv run python downloader/download_data.py --limit 5
    @echo ""

# Download diverse batch (default: 10 objects per type, configurable in config.yaml)
download-batch:
    @echo ""
    @printf "\033[0;34m=== Downloading diverse batch ===\033[0m\n"
    @uv run python downloader/download_data.py
    @echo ""
